123äº‘ç›˜é›†æˆéœ€æ±‚æ–‡æ¡£

  ğŸ“‹ é¡¹ç›®ä¿¡æ¯

| é¡¹ç›®åç§° | Telegram Media Downloader - 123äº‘ç›˜é›†æˆ |
| -------- | --------------------------------------- |
| ç‰ˆæœ¬     | v2.2.1                                  |
| éœ€æ±‚ç±»å‹ | åŠŸèƒ½å¢å¼º                                |
| ä¼˜å…ˆçº§   | ä¸­                                      |
| é¢„ä¼°å·¥æœŸ | 3-5å¤©                                   |
| è´Ÿè´£äºº   | å¼€å‘å›¢é˜Ÿ                                |

---
  ğŸ¯ éœ€æ±‚æ¦‚è¿°

  èƒŒæ™¯

  ç°æœ‰é¡¹ç›®å·²æ”¯æŒrcloneï¼ˆ100+äº‘ç›˜ï¼‰å’Œé˜¿é‡Œäº‘ç›˜(aligo)ä½œä¸ºäº‘å­˜å‚¨é€‰é¡¹ï¼Œç”¨æˆ·éœ€è¦æ›´å¤šäº‘ç›˜é€‰æ‹©ã€‚123äº‘
  ç›˜ä½œä¸ºçŸ¥åå›½å†…äº‘å­˜å‚¨æœåŠ¡ï¼Œå…·æœ‰è‰¯å¥½çš„APIæ”¯æŒå’Œç”¨æˆ·åŸºç¡€ï¼Œé›†æˆåå¯ä¸ºç”¨æˆ·æä¾›æ›´å¤šå­˜å‚¨é€‰æ‹©ã€‚

  ç›®æ ‡

  åœ¨ç°æœ‰äº‘ç›˜æ¶æ„åŸºç¡€ä¸Šï¼Œé›†æˆ123äº‘ç›˜ä½œä¸ºç¬¬ä¸‰ä¸ªäº‘å­˜å‚¨é€‰é¡¹ï¼Œä¿æŒä¸rclone/aligoä¸€è‡´çš„ç”¨æˆ·ä½“éªŒå’ŒåŠŸèƒ½
  å®Œæ•´æ€§ã€‚

  ä»·å€¼

  - æ‰©å±•å­˜å‚¨é€‰æ‹©ï¼šä¸ºç”¨æˆ·æä¾›æ›´å¤šäº‘ç›˜é€‰é¡¹
  - é™ä½ä¾èµ–é£é™©ï¼šåˆ†æ•£å•ä¸€äº‘ç›˜æœåŠ¡çš„ä¾èµ–
  - æå‡ç”¨æˆ·ä½“éªŒï¼šå›½å†…äº‘ç›˜è®¿é—®é€Ÿåº¦æ›´ä¼˜

---
  ğŸ” ç°çŠ¶åˆ†æ

  ç°æœ‰æ¶æ„

  graph TB
      A[Telegram Media Downloader] --> B[CloudDriveæ¨¡å—]
      B --> C[Rcloneé€‚é…å™¨]
      B --> D[Aligoé€‚é…å™¨]
      B --> E[é…ç½®ç®¡ç†]
      E --> F[è·¯å¾„é…ç½®]
      E --> G[æ–‡ä»¶åé…ç½®]
      E --> H[ä¸Šä¼ æ§åˆ¶]

  å·²æœ‰åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | Rclone | Aligo | è¯´æ˜                   |
| -------- | ------ | ----- | ---------------------- |
| æ–‡ä»¶ä¸Šä¼  | âœ…      | âœ…     | æ”¯æŒå„ç§æ–‡ä»¶ç±»å‹       |
| ç›®å½•åˆ›å»º | âœ…      | âœ…     | è‡ªåŠ¨åˆ›å»ºç›®å½•ç»“æ„       |
| è·¯å¾„æ˜ å°„ | âœ…      | âœ…     | æœ¬åœ°è·¯å¾„åˆ°äº‘ç›˜è·¯å¾„æ˜ å°„ |
| æ–‡ä»¶å‹ç¼© | âœ…      | âœ…     | ä¸Šä¼ å‰å¯é€‰å‹ç¼©         |
| æœ¬åœ°åˆ é™¤ | âœ…      | âœ…     | ä¸Šä¼ åå¯é€‰åˆ é™¤æœ¬åœ°æ–‡ä»¶ |
| è¿›åº¦ç›‘æ§ | âœ…      | âŒ     | Rcloneæ”¯æŒè¿›åº¦æ˜¾ç¤º     |
| é”™è¯¯é‡è¯• | âœ…      | âœ…     | ç½‘ç»œå¼‚å¸¸è‡ªåŠ¨é‡è¯•       |

  é…ç½®æœºåˆ¶

  # ç°æœ‰é…ç½®ç»“æ„
  save_path: D:\telegram_media_downloader
  file_path_prefix: [chat_title, media_datetime, media_type]
  file_name_prefix: [message_id, file_name]
  upload_drive:
    enable_upload_file: true
    upload_adapter: rclone|aligo  # ç°æœ‰é€‰é¡¹
    remote_dir: "drive:/telegram"
    after_upload_file_delete: true

---
  ğŸ“ éœ€æ±‚è¯¦æƒ…

  åŠŸèƒ½éœ€æ±‚

  FR-001ï¼š123äº‘ç›˜é€‚é…å™¨å®ç°

  æè¿°ï¼šå®ç°å®Œæ•´çš„123äº‘ç›˜APIé€‚é…å™¨
  ä¼˜å…ˆçº§ï¼šé«˜
  å®ç°æ–¹æ¡ˆï¼š
  # /module/pan123_client.py
  class Pan123Client:
      """123äº‘ç›˜APIå®¢æˆ·ç«¯"""
      async def authenticate() -> str
      async def create_folder(parent_id: int, name: str) -> int
      async def upload_file_single(file_path: str, parent_id: int) -> bool
      async def upload_file_multipart(file_path: str, parent_id: int) -> bool
      async def get_upload_progress(preupload_id: str) -> dict

  éªŒæ”¶æ ‡å‡†ï¼š
  - âœ… æ”¯æŒOAuth2.0è®¤è¯ï¼Œè‡ªåŠ¨è·å–access_token
  - âœ… æ”¯æŒå•æ­¥ä¸Šä¼ ï¼ˆ<1GBæ–‡ä»¶ï¼‰
  - âœ… æ”¯æŒåˆ†ç‰‡ä¸Šä¼ ï¼ˆâ‰¥1GBæ–‡ä»¶ï¼‰
  - âœ… æ”¯æŒç§’ä¼ æ£€æµ‹ï¼ˆMD5åŒ¹é…ï¼‰
  - âœ… æ”¯æŒä¸Šä¼ è¿›åº¦ç›‘æ§
  - âœ… æ”¯æŒæ–‡ä»¶å¤¹åˆ›å»ºå’Œç®¡ç†

  FR-002ï¼šè·¯å¾„æ˜ å°„ç³»ç»Ÿ

  æè¿°ï¼šè§£å†³123äº‘ç›˜åŸºäºç›®å½•IDçš„è·¯å¾„ç®¡ç†é—®é¢˜
  ä¼˜å…ˆçº§ï¼šé«˜
  å®ç°æ–¹æ¡ˆï¼š
  # /module/pan123_client.py  
  class Pan123PathManager:
      def __init__(self, client: Pan123Client):
          self.path_cache = {}  # "/telegram/é¢‘é“/2023_12" -> folder_id

      async def ensure_path_exists(self, remote_path: str) -> int:
          """é€’å½’åˆ›å»ºè·¯å¾„ï¼Œè¿”å›æœ€ç»ˆç›®å½•ID"""
          # è·¯å¾„è§£æ: /telegram/é¢‘é“å/2023_12/photo
          # é€’å½’åˆ›å»º: æ ¹ç›®å½•(0) -> telegram -> é¢‘é“å -> 2023_12 -> photo
          # ç¼“å­˜ç»“æœ: é¿å…é‡å¤APIè°ƒç”¨

  éªŒæ”¶æ ‡å‡†ï¼š
  - âœ… æ”¯æŒé€’å½’ç›®å½•åˆ›å»º
  - âœ… è·¯å¾„åˆ°IDæ˜ å°„ç¼“å­˜æœºåˆ¶
  - âœ… ä¸ç°æœ‰file_path_prefixé…ç½®å®Œå…¨å…¼å®¹
  - âœ… è‡ªåŠ¨å¤„ç†è·¯å¾„åˆ†éš”ç¬¦è½¬æ¢

  FR-003ï¼šé…ç½®é›†æˆ

  æè¿°ï¼šå°†123äº‘ç›˜é›†æˆåˆ°ç°æœ‰é…ç½®ç³»ç»Ÿ
  ä¼˜å…ˆçº§ï¼šé«˜å®ç°æ–¹æ¡ˆï¼š
  # config.yamlæ‰©å±•
  upload_drive:
    upload_adapter: pan123           # ğŸ†• æ–°å¢é€‰é¡¹
    client_id: "your_client_id"      # ğŸ†• 123äº‘ç›˜ä¸“ç”¨
    client_secret: "your_secret"     # ğŸ†• 123äº‘ç›˜ä¸“ç”¨  
    remote_dir: "/telegram"          # äº‘ç›˜æ ¹ç›®å½•
    # å…¶ä»–é…ç½®ä¸ç°æœ‰ä¿æŒä¸€è‡´

  éªŒæ”¶æ ‡å‡†ï¼š
  - âœ… é…ç½®è§£æå…¼å®¹ç°æœ‰æ ¼å¼
  - âœ… æ–°å¢123äº‘ç›˜ä¸“ç”¨é…ç½®é¡¹
  - âœ… é…ç½®éªŒè¯å’Œé”™è¯¯æç¤º
  - âœ… å‘å‰å…¼å®¹ï¼Œä¸å½±å“ç°æœ‰ç”¨æˆ·

  FR-004ï¼šCloudDriveæ¨¡å—é›†æˆ

  æè¿°ï¼šå°†123äº‘ç›˜é€‚é…å™¨é›†æˆåˆ°CloudDriveç»Ÿä¸€æ¥å£
  ä¼˜å…ˆçº§ï¼šé«˜
  å®ç°æ–¹æ¡ˆï¼š
  # /module/cloud_drive.pyä¿®æ”¹
  class CloudDrive:
      @staticmethod  
      async def pan123_upload_file(drive_config, save_path, local_file_path) -> bool:
          # 1. å¤„ç†æ–‡ä»¶å‹ç¼©é€»è¾‘
          # 2. è®¡ç®—è¿œç¨‹è·¯å¾„ï¼ˆå¤ç”¨ç°æœ‰é€»è¾‘ï¼‰
          # 3. ç¡®ä¿è¿œç¨‹ç›®å½•å­˜åœ¨
          # 4. é€‰æ‹©åˆé€‚ä¸Šä¼ æ–¹å¼ï¼ˆå•æ­¥/åˆ†ç‰‡ï¼‰
          # 5. æ‰§è¡Œä¸Šä¼ æ“ä½œ
          # 6. å¤„ç†ä¸Šä¼ ååˆ é™¤é€»è¾‘

      @staticmethod
      async def upload_file(drive_config, save_path, local_file_path) -> bool:
          # åœ¨ç°æœ‰rclone/aligoåŸºç¡€ä¸Šæ–°å¢pan123åˆ†æ”¯
          if drive_config.upload_adapter == "pan123":
              return await CloudDrive.pan123_upload_file(...)

  éªŒæ”¶æ ‡å‡†ï¼š
  - âœ… ä¸rclone/aligoä½¿ç”¨ç›¸åŒçš„è°ƒç”¨æ¥å£
  - âœ… æ”¯æŒæ‰€æœ‰ç°æœ‰åŠŸèƒ½ï¼ˆå‹ç¼©ã€åˆ é™¤ã€è¿›åº¦ç­‰ï¼‰
  - âœ… å¼‚å¸¸å¤„ç†ä¸ç°æœ‰æ¨¡å—ä¸€è‡´
  - âœ… æ—¥å¿—è®°å½•æ ¼å¼ç»Ÿä¸€

  éåŠŸèƒ½éœ€æ±‚

  NFR-001ï¼šæ€§èƒ½è¦æ±‚

  - ä¸Šä¼ é€Ÿåº¦ï¼šå……åˆ†åˆ©ç”¨123äº‘ç›˜APIæ€§èƒ½
  - å¹¶å‘æ§åˆ¶ï¼šéµå®ˆAPIé¢‘ç‡é™åˆ¶ï¼ˆæ–‡ä»¶ä¸Šä¼ 2æ¬¡/ç§’ï¼‰
  - å†…å­˜å ç”¨ï¼šå¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œæ§åˆ¶å†…å­˜ä½¿ç”¨
  - ç½‘ç»œä¼˜åŒ–ï¼šæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œç½‘ç»œå¼‚å¸¸è‡ªåŠ¨é‡è¯•

  NFR-002ï¼šå¯é æ€§è¦æ±‚

  - æ•°æ®å®‰å…¨ï¼šä»…ä¸Šä¼ æˆåŠŸååˆ é™¤æœ¬åœ°æ–‡ä»¶
  - å¼‚å¸¸æ¢å¤ï¼šä¸Šä¼ å¤±è´¥ä¿ç•™æœ¬åœ°æ–‡ä»¶
  - ä»¤ç‰Œç®¡ç†ï¼šaccess_tokenè‡ªåŠ¨åˆ·æ–°
  - é”™è¯¯å¤„ç†ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·å’Œæ—¥å¿—è®°å½•

  NFR-003ï¼šå…¼å®¹æ€§è¦æ±‚

  - å‘å‰å…¼å®¹ï¼šä¸å½±å“ç°æœ‰rclone/aligoç”¨æˆ·
  - é…ç½®å…¼å®¹ï¼šç°æœ‰é…ç½®æ ¼å¼ä¿æŒä¸å˜
  - å¹³å°å…¼å®¹ï¼šæ”¯æŒWindows/Linux/macOS
  - Pythonç‰ˆæœ¬ï¼šæ”¯æŒPython 3.7+

  NFR-004ï¼šå¯ç»´æŠ¤æ€§è¦æ±‚

  - ä»£ç ç»“æ„ï¼šéµå¾ªç°æœ‰æ¶æ„æ¨¡å¼
  - å•å…ƒæµ‹è¯•ï¼šæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–ç‡>80%
  - æ–‡æ¡£å®Œæ•´ï¼šAPIæ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜
  - æ—¥å¿—è§„èŒƒï¼šç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼å’Œçº§åˆ«

---
  ğŸ› ï¸ å®ç°æ–¹æ¡ˆ

  æŠ€æœ¯æ¶æ„

  graph TB
      subgraph "ç°æœ‰æ¶æ„"
          A[Application] --> B[CloudDrive]
          B --> C[RcloneAdapter]
          B --> D[AligoAdapter]
      end

      subgraph "æ–°å¢æ¨¡å—"
          E[Pan123Client] --> F[è®¤è¯ç®¡ç†]
          E --> G[æ–‡ä»¶ä¸Šä¼ ]
          E --> H[ç›®å½•ç®¡ç†]
          I[Pan123PathManager] --> J[è·¯å¾„ç¼“å­˜]
          I --> K[IDæ˜ å°„]
      end
    
      subgraph "é›†æˆæ¥å£"
          B --> L[Pan123Adapter]
          L --> E
          L --> I
      end

  æ¨¡å—è®¾è®¡

  1. Pan123Clientï¼ˆæ ¸å¿ƒå®¢æˆ·ç«¯ï¼‰

  æ–‡ä»¶ï¼š/module/pan123_client.py
  èŒè´£ï¼šå°è£…123äº‘ç›˜APIè°ƒç”¨
  å…³é”®æ–¹æ³•ï¼š
  class Pan123Client:
      def __init__(self, client_id: str, client_secret: str):
          self.base_url = "https://open-api.123pan.com"
          self.session = httpx.AsyncClient()
          self.access_token = None

      async def authenticate(self) -> str:
          """è·å–è®¿é—®ä»¤ç‰Œ"""
          payload = {
              "clientID": self.client_id,
              "clientSecret": self.client_secret
          }
          headers = {"Platform": "open_platform"}
          # POST /api/v1/access_token
    
      async def get_upload_domains(self) -> List[str]:
          """è·å–ä¸Šä¼ åŸŸååˆ—è¡¨"""
          # GET /upload/v2/file/domain
    
      async def create_file(self, parent_id: int, filename: str, 
                           etag: str, size: int) -> dict:
          """åˆ›å»ºæ–‡ä»¶ï¼ˆæ£€æµ‹ç§’ä¼ ï¼‰"""
          # POST /upload/v2/file/create
    
      async def upload_single(self, file_path: str, parent_id: int, 
                             **kwargs) -> bool:
          """å•æ­¥ä¸Šä¼ """
          # POST {domain}/upload/v2/file/single/create
    
      async def upload_slice(self, preupload_id: str, slice_no: int,
                            slice_data: bytes, slice_md5: str) -> bool:
          """åˆ†ç‰‡ä¸Šä¼ """
          # POST {domain}/upload/v2/file/slice
    
      async def upload_complete(self, preupload_id: str) -> dict:
          """å®Œæˆä¸Šä¼ """
          # POST /upload/v2/file/upload_complete
    
      async def create_folder(self, parent_id: int, name: str) -> int:
          """åˆ›å»ºæ–‡ä»¶å¤¹"""
          # POST /upload/v1/file/mkdir

  2. Pan123PathManagerï¼ˆè·¯å¾„ç®¡ç†å™¨ï¼‰

  æ–‡ä»¶ï¼š/module/pan123_client.py
  èŒè´£ï¼šå¤„ç†è·¯å¾„åˆ°ç›®å½•IDçš„æ˜ å°„
  å…³é”®æ–¹æ³•ï¼š
  class Pan123PathManager:
      def __init__(self, client: Pan123Client):
          self.client = client
          self.path_cache = {}  # è·¯å¾„ç¼“å­˜

      async def ensure_path_exists(self, remote_path: str) -> int:
          """ç¡®ä¿è·¯å¾„å­˜åœ¨ï¼Œè¿”å›æœ€ç»ˆç›®å½•ID"""
          # ç¤ºä¾‹: "/telegram/TechChannel/2023_12/photo"
          # è§£æä¸º: ["telegram", "TechChannel", "2023_12", "photo"]
          # é€’å½’åˆ›å»ºå¹¶ç¼“å­˜æ¯å±‚ç›®å½•ID
    
      def _normalize_path(self, path: str) -> str:
          """æ ‡å‡†åŒ–è·¯å¾„æ ¼å¼"""
          return path.strip('/').replace('\\', '/')
    
      def clear_cache(self):
          """æ¸…ç©ºè·¯å¾„ç¼“å­˜"""
          self.path_cache.clear()

  3. CloudDriveé›†æˆï¼ˆé€‚é…å™¨å±‚ï¼‰

  æ–‡ä»¶ï¼š/module/cloud_drive.py
  èŒè´£ï¼šå°†123äº‘ç›˜é›†æˆåˆ°ç»Ÿä¸€äº‘ç›˜æ¥å£
  ä¿®æ”¹å†…å®¹ï¼š
  class CloudDriveConfig:
      def __init__(self):
          # ç°æœ‰å­—æ®µ...
          self.pan123_client_id = ""       # ğŸ†•
          self.pan123_client_secret = ""   # ğŸ†•  
          self.pan123_client = None        # ğŸ†•
          self.pan123_path_manager = None  # ğŸ†•

  class CloudDrive:
      @staticmethod
      async def pan123_upload_file(drive_config: CloudDriveConfig,
                                  save_path: str, 
                                  local_file_path: str,
                                  progress_callback: Callable = None,
                                  progress_args: tuple = ()) -> bool:
          """123äº‘ç›˜ä¸Šä¼ å®ç°"""
          # å®ç°ç»†èŠ‚è§ä¸‹æ–‡

      @staticmethod  
      async def upload_file(drive_config: CloudDriveConfig,
                           save_path: str,
                           local_file_path: str) -> bool:
          """ç»Ÿä¸€ä¸Šä¼ æ¥å£"""
          if drive_config.upload_adapter == "rclone":
              return await CloudDrive.rclone_upload_file(...)
          elif drive_config.upload_adapter == "aligo":
              return CloudDrive.aligo_upload_file(...)
          elif drive_config.upload_adapter == "pan123":  # ğŸ†•
              return await CloudDrive.pan123_upload_file(...)

  4. é…ç½®ç®¡ç†é›†æˆ

  æ–‡ä»¶ï¼š/module/app.py
  èŒè´£ï¼šè§£æ123äº‘ç›˜é…ç½®å¹¶åˆå§‹åŒ–å®¢æˆ·ç«¯
  ä¿®æ”¹å†…å®¹ï¼š
  class Application:
      def assign_config(self, _config: dict) -> bool:
          """é…ç½®è§£æ"""
          if _config.get("upload_drive"):
              upload_drive_config = _config["upload_drive"]

              # ğŸ†• 123äº‘ç›˜é…ç½®è§£æ
              if upload_drive_config.get("client_id"):
                  self.cloud_drive_config.pan123_client_id = upload_drive_config["client_id"]
              if upload_drive_config.get("client_secret"):
                  self.cloud_drive_config.pan123_client_secret =
  upload_drive_config["client_secret"]

      def pre_run(self):
          """è¿è¡Œå‰åˆå§‹åŒ–"""
          # ğŸ†• 123äº‘ç›˜å®¢æˆ·ç«¯åˆå§‹åŒ–
          if (self.cloud_drive_config.enable_upload_file and
              self.cloud_drive_config.upload_adapter == "pan123"):
    
              self.cloud_drive_config.pan123_client = Pan123Client(
                  self.cloud_drive_config.pan123_client_id,
                  self.cloud_drive_config.pan123_client_secret
              )
              self.cloud_drive_config.pan123_path_manager = Pan123PathManager(
                  self.cloud_drive_config.pan123_client
              )

  æ ¸å¿ƒç®—æ³•å®ç°

  1. æ™ºèƒ½ä¸Šä¼ ç­–ç•¥

  async def pan123_upload_file(drive_config, save_path, local_file_path, 
                              progress_callback=None, progress_args=()) -> bool:
      """123äº‘ç›˜ä¸Šä¼ æ ¸å¿ƒå®ç°"""
      upload_status = False
      zip_file_path = ""

      try:
          # 1. å¤„ç†æ–‡ä»¶å‹ç¼©
          file_path = local_file_path
          if drive_config.before_upload_file_zip:
              zip_file_path = CloudDrive.zip_file(local_file_path)
              file_path = zip_file_path
    
          # 2. è®¡ç®—è¿œç¨‹è·¯å¾„ï¼ˆå¤ç”¨ç°æœ‰é€»è¾‘ï¼‰
          relative_dir = os.path.dirname(local_file_path).replace(save_path, "")
          remote_path = (drive_config.remote_dir + "/" +
                        relative_dir.replace("\\", "/")).replace("//", "/")
    
          # 3. ç¡®ä¿è¿œç¨‹ç›®å½•å­˜åœ¨
          parent_id = await drive_config.pan123_path_manager.ensure_path_exists(remote_path)
    
          # 4. è·å–æ–‡ä»¶ä¿¡æ¯
          file_size = os.path.getsize(file_path)
          file_name = os.path.basename(file_path)
          file_md5 = await calculate_md5(file_path)
    
          # 5. åˆ›å»ºæ–‡ä»¶ï¼ˆæ£€æµ‹ç§’ä¼ ï¼‰
          create_result = await drive_config.pan123_client.create_file(
              parent_id=parent_id,
              filename=file_name,
              etag=file_md5,
              size=file_size
          )
    
          # 6. å¤„ç†ç§’ä¼ 
          if create_result.get("reuse"):
              logger.info(f"123pan instant upload: {file_name}")
              upload_status = True
          else:
              # 7. é€‰æ‹©ä¸Šä¼ ç­–ç•¥
              if file_size < 1024 * 1024 * 1024:  # <1GB å•æ­¥ä¸Šä¼ 
                  upload_status = await _upload_single_file(
                      drive_config, file_path, parent_id, progress_callback, progress_args
                  )
              else:  # â‰¥1GB åˆ†ç‰‡ä¸Šä¼ 
                  upload_status = await _upload_multipart_file(
                      drive_config, file_path, create_result, progress_callback, progress_args
                  )
    
          # 8. ä¸Šä¼ åå¤„ç†ï¼ˆä¸ç°æœ‰é€»è¾‘ä¸€è‡´ï¼‰
          if upload_status:
              drive_config.total_upload_success_file_count += 1
              if drive_config.after_upload_file_delete:
                  os.remove(local_file_path)
              if zip_file_path and drive_config.before_upload_file_zip:
                  os.remove(zip_file_path)
              logger.info(f"123pan upload success: {local_file_path}")
    
      except Exception as e:
          logger.error(f"123pan upload error: {e}")
          upload_status = False
    
      return upload_status

  2. åˆ†ç‰‡ä¸Šä¼ å®ç°

  async def _upload_multipart_file(drive_config, file_path, create_result, 
                                  progress_callback=None, progress_args=()) -> bool:
      """åˆ†ç‰‡ä¸Šä¼ å®ç°"""
      preupload_id = create_result["preuploadID"]
      slice_size = create_result["sliceSize"]
      upload_domains = create_result["servers"]

      total_size = os.path.getsize(file_path)
      uploaded_size = 0
      slice_no = 1
    
      try:
          with open(file_path, 'rb') as f:
              while True:
                  # è¯»å–åˆ†ç‰‡æ•°æ®
                  slice_data = f.read(slice_size)
                  if not slice_data:
                      break
    
                  # è®¡ç®—åˆ†ç‰‡MD5
                  slice_md5 = hashlib.md5(slice_data).hexdigest()
    
                  # ä¸Šä¼ åˆ†ç‰‡
                  success = await drive_config.pan123_client.upload_slice(
                      preupload_id=preupload_id,
                      slice_no=slice_no,
                      slice_data=slice_data,
                      slice_md5=slice_md5,
                      upload_domains=upload_domains
                  )
    
                  if not success:
                      return False
    
                  # æ›´æ–°è¿›åº¦
                  uploaded_size += len(slice_data)
                  if progress_callback:
                      progress = (uploaded_size / total_size) * 100
                      await progress_callback(uploaded_size, total_size, progress,
  *progress_args)

                  slice_no += 1
    
          # å®Œæˆä¸Šä¼ 
          complete_result = await drive_config.pan123_client.upload_complete(preupload_id)
          return complete_result.get("completed", False)
    
      except Exception as e:
          logger.error(f"123pan multipart upload error: {e}")
          return False

---
  ğŸ“‹ å®ç°è®¡åˆ’

  å¼€å‘é˜¶æ®µ

  é˜¶æ®µ1ï¼šåŸºç¡€æ¡†æ¶ï¼ˆ1å¤©ï¼‰

  ä»»åŠ¡ï¼š
  - åˆ›å»ºPan123ClientåŸºç¡€æ¡†æ¶
  - å®ç°OAuth2.0è®¤è¯æœºåˆ¶
  - æ·»åŠ åŸºç¡€HTTPè¯·æ±‚å°è£…
  - å®ç°ä»¤ç‰Œè‡ªåŠ¨åˆ·æ–°é€»è¾‘

  äº¤ä»˜ç‰©ï¼š
  - module/pan123_client.py åŸºç¡€ç‰ˆæœ¬
  - è®¤è¯åŠŸèƒ½å•å…ƒæµ‹è¯•

  é˜¶æ®µ2ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ2å¤©ï¼‰

  ä»»åŠ¡ï¼š
  - å®ç°å•æ­¥ä¸Šä¼ åŠŸèƒ½
  - å®ç°åˆ†ç‰‡ä¸Šä¼ åŠŸèƒ½
  - å®ç°ç›®å½•åˆ›å»ºå’Œç®¡ç†
  - å®ç°è·¯å¾„æ˜ å°„ç³»ç»Ÿ
  - æ·»åŠ ç§’ä¼ æ£€æµ‹æœºåˆ¶

  äº¤ä»˜ç‰©ï¼š
  - å®Œæ•´çš„Pan123Clientå®ç°
  - Pan123PathManagerå®ç°
  - æ ¸å¿ƒåŠŸèƒ½å•å…ƒæµ‹è¯•

  é˜¶æ®µ3ï¼šç³»ç»Ÿé›†æˆï¼ˆ1å¤©ï¼‰

  ä»»åŠ¡ï¼š
  - é›†æˆåˆ°CloudDriveæ¨¡å—
  - ä¿®æ”¹é…ç½®è§£æé€»è¾‘
  - æ·»åŠ 123äº‘ç›˜é€‚é…å™¨
  - å®ç°ç»Ÿä¸€æ¥å£è°ƒç”¨

  äº¤ä»˜ç‰©ï¼š
  - ä¿®æ”¹åçš„cloud_drive.py
  - ä¿®æ”¹åçš„app.py
  - é›†æˆæµ‹è¯•ç”¨ä¾‹

  é˜¶æ®µ4ï¼šæµ‹è¯•ä¼˜åŒ–ï¼ˆ1å¤©ï¼‰

  ä»»åŠ¡ï¼š
  - å®Œæ•´åŠŸèƒ½æµ‹è¯•
  - å¼‚å¸¸åœºæ™¯æµ‹è¯•
  - æ€§èƒ½ä¼˜åŒ–è°ƒæ•´
  - æ–‡æ¡£ç¼–å†™æ›´æ–°

  äº¤ä»˜ç‰©ï¼š
  - æµ‹è¯•æŠ¥å‘Š
  - æ€§èƒ½è¯„ä¼°æŠ¥å‘Š
  - ç”¨æˆ·æ–‡æ¡£æ›´æ–°

  æµ‹è¯•ç­–ç•¥

  å•å…ƒæµ‹è¯•

  # tests/test_pan123_client.py
  class TestPan123Client:
      async def test_authenticate(self):
          """æµ‹è¯•è®¤è¯åŠŸèƒ½"""

      async def test_create_folder(self):
          """æµ‹è¯•åˆ›å»ºæ–‡ä»¶å¤¹"""
    
      async def test_upload_single_file(self):
          """æµ‹è¯•å•æ­¥ä¸Šä¼ """
    
      async def test_upload_multipart_file(self):
          """æµ‹è¯•åˆ†ç‰‡ä¸Šä¼ """
    
      async def test_path_mapping(self):
          """æµ‹è¯•è·¯å¾„æ˜ å°„"""

  é›†æˆæµ‹è¯•

  # tests/test_pan123_integration.py  
  class TestPan123Integration:
      async def test_upload_with_compression(self):
          """æµ‹è¯•å‹ç¼©ä¸Šä¼ """

      async def test_upload_with_deletion(self):
          """æµ‹è¯•ä¸Šä¼ ååˆ é™¤"""
    
      async def test_directory_structure(self):
          """æµ‹è¯•ç›®å½•ç»“æ„åˆ›å»º"""
    
      async def test_config_compatibility(self):
          """æµ‹è¯•é…ç½®å…¼å®¹æ€§"""

  æ€§èƒ½æµ‹è¯•

  - å°æ–‡ä»¶ä¸Šä¼ ï¼š<10MBæ–‡ä»¶ä¸Šä¼ é€Ÿåº¦æµ‹è¯•
  - å¤§æ–‡ä»¶ä¸Šä¼ ï¼š>1GBæ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ æµ‹è¯•
  - å¹¶å‘ä¸Šä¼ ï¼šå¤šæ–‡ä»¶å¹¶å‘ä¸Šä¼ æµ‹è¯•
  - ç½‘ç»œå¼‚å¸¸ï¼šæ–­ç½‘æ¢å¤åœºæ™¯æµ‹è¯•

---
  ğŸ¯ éªŒæ”¶æ ‡å‡†

  åŠŸèƒ½éªŒæ”¶

  AC-001ï¼šåŸºç¡€åŠŸèƒ½

  - âœ… æ”¯æŒ123äº‘ç›˜è´¦å·è®¤è¯ç™»å½•
  - âœ… æ”¯æŒå•æ–‡ä»¶ä¸Šä¼ ï¼ˆå„ç§æ–‡ä»¶ç±»å‹ï¼‰
  - âœ… æ”¯æŒæ–‡ä»¶å¤¹è‡ªåŠ¨åˆ›å»º
  - âœ… æ”¯æŒç°æœ‰è·¯å¾„é…ç½®ï¼ˆfile_path_prefixï¼‰
  - âœ… æ”¯æŒç°æœ‰æ–‡ä»¶åé…ç½®ï¼ˆfile_name_prefixï¼‰

  AC-002ï¼šé«˜çº§åŠŸèƒ½

  - âœ… æ”¯æŒå¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 
  - âœ… æ”¯æŒæ–‡ä»¶ç§’ä¼ ï¼ˆMD5æ£€æµ‹ï¼‰
  - âœ… æ”¯æŒä¸Šä¼ è¿›åº¦ç›‘æ§
  - âœ… æ”¯æŒä¸Šä¼ å‰æ–‡ä»¶å‹ç¼©
  - âœ… æ”¯æŒä¸Šä¼ åæœ¬åœ°æ–‡ä»¶åˆ é™¤

  AC-003ï¼šé…ç½®åŠŸèƒ½

  - âœ… é…ç½®æ–‡ä»¶æ ¼å¼ä¸ç°æœ‰ä¿æŒä¸€è‡´
  - âœ… æ”¯æŒupload_adapteråˆ‡æ¢
  - âœ… æ–°å¢client_id/client_secreté…ç½®é¡¹
  - âœ… é…ç½®é”™è¯¯æ—¶æœ‰æ˜ç¡®æç¤ºä¿¡æ¯

  AC-004ï¼šå…¼å®¹æ€§

  - âœ… ä¸å½±å“ç°æœ‰rcloneç”¨æˆ·ä½¿ç”¨
  - âœ… ä¸å½±å“ç°æœ‰aligoç”¨æˆ·ä½¿ç”¨
  - âœ… ç°æœ‰é…ç½®æ–‡ä»¶æ— éœ€ä¿®æ”¹
  - âœ… æ”¯æŒWindows/Linux/macOSå¹³å°

  æ€§èƒ½éªŒæ”¶

  PC-001ï¼šä¸Šä¼ æ€§èƒ½

  - âœ… å°æ–‡ä»¶ä¸Šä¼ é€Ÿåº¦â‰¥5MB/sï¼ˆç½‘ç»œæ¡ä»¶è‰¯å¥½ï¼‰
  - âœ… å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ æ”¯æŒæ–­ç‚¹ç»­ä¼ 
  - âœ… å¹¶å‘ä¸Šä¼ ä¸è¶…è¿‡APIé¢‘ç‡é™åˆ¶
  - âœ… å†…å­˜å ç”¨<200MBï¼ˆå¤„ç†1GBæ–‡ä»¶æ—¶ï¼‰

  PC-002ï¼šç¨³å®šæ€§

  - âœ… ä¸Šä¼ æˆåŠŸç‡â‰¥95%ï¼ˆæ­£å¸¸ç½‘ç»œç¯å¢ƒï¼‰
  - âœ… ç½‘ç»œå¼‚å¸¸æ—¶è‡ªåŠ¨é‡è¯•â‰¤3æ¬¡
  - âœ… ä¸Šä¼ å¤±è´¥æ—¶ä¸åˆ é™¤æœ¬åœ°æ–‡ä»¶
  - âœ… ä»¤ç‰Œè¿‡æœŸæ—¶è‡ªåŠ¨åˆ·æ–°

  è´¨é‡éªŒæ”¶

  QC-001ï¼šä»£ç è´¨é‡

  - âœ… ä»£ç ç¬¦åˆPEP 8è§„èŒƒ
  - âœ… æ ¸å¿ƒåŠŸèƒ½å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥80%
  - âœ… æ— å®‰å…¨æ¼æ´ï¼ˆæ•æ„Ÿä¿¡æ¯ä¸è®°å½•æ—¥å¿—ï¼‰
  - âœ… å¼‚å¸¸å¤„ç†è¦†ç›–æ‰€æœ‰APIè°ƒç”¨

  QC-002ï¼šæ–‡æ¡£è´¨é‡

  - âœ… README.mdåŒ…å«123äº‘ç›˜é…ç½®è¯´æ˜
  - âœ… é…ç½®ç¤ºä¾‹å®Œæ•´æ­£ç¡®
  - âœ… APIæ–‡æ¡£å®Œæ•´ï¼ˆå¦‚éœ€è¦ï¼‰
  - âœ… é”™è¯¯æ’æŸ¥æŒ‡å—

---
  ğŸ“Š å½±å“è¯„ä¼°

  ç”¨æˆ·å½±å“

  æ­£é¢å½±å“

  - âœ… æ–°å¢é€‰æ‹©ï¼šç”¨æˆ·å¤šä¸€ä¸ªäº‘ç›˜å­˜å‚¨é€‰é¡¹
  - âœ… ä½“éªŒä¸€è‡´ï¼šä½¿ç”¨æ–¹å¼ä¸ç°æœ‰äº‘ç›˜å®Œå…¨ç›¸åŒ
  - âœ… åŠŸèƒ½å®Œæ•´ï¼šæ”¯æŒæ‰€æœ‰ç°æœ‰äº‘ç›˜åŠŸèƒ½
  - âœ… æ€§èƒ½æå‡ï¼šå›½å†…äº‘ç›˜è®¿é—®é€Ÿåº¦æ›´ä¼˜

  è´Ÿé¢å½±å“

  - âŒ å­¦ä¹ æˆæœ¬ï¼šéœ€è¦äº†è§£123äº‘ç›˜APIç”³è¯·æµç¨‹
  - âŒ ä¾èµ–å¢åŠ ï¼šæ–°å¢httpxç­‰ä¾èµ–åº“
  - âŒ ç»´æŠ¤æˆæœ¬ï¼šéœ€è¦è·Ÿè¿›123äº‘ç›˜APIå˜æ›´

  ç³»ç»Ÿå½±å“

  æ¶æ„å½±å“

  - ğŸ”„ æ¨¡å—æ–°å¢ï¼šæ–°å¢pan123_clientæ¨¡å—
  - ğŸ”„ é…ç½®æ‰©å±•ï¼šupload_driveé…ç½®æ–°å¢å­—æ®µ
  - ğŸ”„ ä¾èµ–æ›´æ–°ï¼šrequirements.txtæ–°å¢httpx

  å…¼å®¹æ€§å½±å“

  - âœ… å‘å‰å…¼å®¹ï¼šç°æœ‰é…ç½®å’ŒåŠŸèƒ½å®Œå…¨å…¼å®¹
  - âœ… å¹³æ»‘å‡çº§ï¼šç”¨æˆ·å¯é€‰æ‹©æ€§å¯ç”¨
  - âœ… å›æ»šæ”¯æŒï¼šå¯éšæ—¶åˆ‡æ¢å›åŸæœ‰äº‘ç›˜

  é£é™©è¯„ä¼°

  æŠ€æœ¯é£é™©

| é£é™©           | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½                       |
| -------------- | ---- | ---- | ------------------------------ |
| 123äº‘ç›˜APIå˜æ›´ | ä¸­   | ä½   | åŠæ—¶è·Ÿè¿›å®˜æ–¹æ–‡æ¡£ï¼Œé¢„ç•™é€‚é…æ—¶é—´ |
| è®¤è¯ä»¤ç‰Œå¤±æ•ˆ   | ä¸­   | ä¸­   | å®ç°è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼Œç”¨æˆ·å‹å¥½æç¤º |
| ä¸Šä¼ é™åˆ¶å˜æ›´   | ä½   | ä½   | åŠ¨æ€è·å–é™åˆ¶å‚æ•°ï¼Œå¼¹æ€§å¤„ç†     |
| ç½‘ç»œè¿æ¥å¼‚å¸¸   | ä¸­   | é«˜   | å®Œå–„é‡è¯•æœºåˆ¶ï¼Œç¦»çº¿æ’é˜ŸåŠŸèƒ½     |

  ä¸šåŠ¡é£é™©

| é£é™©           | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½                     |
| -------------- | ---- | ---- | ---------------------------- |
| ç”¨æˆ·é…ç½®é”™è¯¯   | ä¸­   | ä¸­   | è¯¦ç»†é…ç½®è¯´æ˜ï¼Œé”™è¯¯ä¿¡æ¯å‹å¥½   |
| äº‘ç›˜å®¹é‡ä¸è¶³   | ä½   | ä¸­   | ä¸Šä¼ å‰å®¹é‡æ£€æŸ¥ï¼Œæ˜ç¡®æç¤º     |
| æœåŠ¡å•†æ”¿ç­–å˜æ›´ | é«˜   | ä½   | ä¿æŒå¤šäº‘ç›˜é€‰æ‹©ï¼Œé™ä½å•ä¸€ä¾èµ– |

---
  ğŸ“ˆ æˆåŠŸæŒ‡æ ‡

  æŠ€æœ¯æŒ‡æ ‡

  - åŠŸèƒ½å®Œæˆåº¦ï¼š100%éªŒæ”¶æ ‡å‡†é€šè¿‡
  - ä»£ç è´¨é‡ï¼šå•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥80%
  - æ€§èƒ½è¡¨ç°ï¼šä¸Šä¼ é€Ÿåº¦è¾¾åˆ°é¢„æœŸç›®æ ‡
  - ç¨³å®šæ€§ï¼šä¸Šä¼ æˆåŠŸç‡â‰¥95%

  ç”¨æˆ·æŒ‡æ ‡

  - é‡‡ç”¨ç‡ï¼šè‡³å°‘10%ç”¨æˆ·å°è¯•ä½¿ç”¨123äº‘ç›˜
  - æ»¡æ„åº¦ï¼šç”¨æˆ·åé¦ˆè¯„åˆ†â‰¥4.0/5.0
  - é—®é¢˜åé¦ˆï¼šä¸¥é‡é—®é¢˜<3ä¸ª/æœˆ
  - æ–‡æ¡£è¯„ä»·ï¼šé…ç½®è¯´æ˜æ¸…æ™°æ˜“æ‡‚

  ä¸šåŠ¡æŒ‡æ ‡

  - å…¼å®¹æ€§ï¼šç°æœ‰ç”¨æˆ·0å½±å“
  - æ‰©å±•æ€§ï¼šä¸ºåç»­äº‘ç›˜é›†æˆæä¾›å‚è€ƒæ¶æ„
  - ç»´æŠ¤æ€§ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
  - ç¤¾åŒºåé¦ˆï¼šGitHub Issuesç›¸å…³é—®é¢˜è§£å†³åŠæ—¶

---
  ğŸ‰ é¢„æœŸæ•ˆæœ

  æœ€ç»ˆäº¤ä»˜ç‰©

  ä»£ç æ¨¡å—

  module/
  â”œâ”€â”€ pan123_client.py          # ğŸ†• 123äº‘ç›˜å®¢æˆ·ç«¯
  â”œâ”€â”€ cloud_drive.py           # ğŸ”„ é›†æˆ123äº‘ç›˜é€‚é…å™¨
  â”œâ”€â”€ app.py                   # ğŸ”„ æ·»åŠ 123äº‘ç›˜é…ç½®è§£æ
  â””â”€â”€ ...

  tests/
  â”œâ”€â”€ test_pan123_client.py    # ğŸ†• 123äº‘ç›˜å•å…ƒæµ‹è¯•
  â”œâ”€â”€ test_pan123_integration.py # ğŸ†• 123äº‘ç›˜é›†æˆæµ‹è¯•
  â””â”€â”€ ...

  requirements.txt             # ğŸ”„ æ–°å¢httpxä¾èµ–
  README.md                    # ğŸ”„ æ·»åŠ 123äº‘ç›˜é…ç½®è¯´æ˜
  README_CN.md                 # ğŸ”„ æ·»åŠ 123äº‘ç›˜ä¸­æ–‡è¯´æ˜

  é…ç½®ç¤ºä¾‹

  # ç”¨æˆ·é…ç½®ç¤ºä¾‹
  save_path: D:\telegram_media_downloader
  file_path_prefix:
    - chat_title
    - media_datetime
    - media_type
  file_name_prefix:
    - message_id
    - file_name
  upload_drive:
    enable_upload_file: true
    upload_adapter: pan123              # ğŸ†• 123äº‘ç›˜é€‰é¡¹
    remote_dir: "/telegram"
    client_id: "your_123pan_client_id"  # ğŸ†• éœ€è¦ç”¨æˆ·ç”³è¯·
    client_secret: "your_123pan_secret" # ğŸ†• éœ€è¦ç”¨æˆ·ç”³è¯·
    before_upload_file_zip: false
    after_upload_file_delete: true

  ç”¨æˆ·ä½“éªŒæ•ˆæœ

  ä½¿ç”¨æµç¨‹

  1. é…ç½®ç®€å•ï¼šåœ¨config.yamlä¸­è®¾ç½®123äº‘ç›˜å‚æ•°
  2. æ— ç¼åˆ‡æ¢ï¼šupload_adapteræ”¹ä¸ºpan123å³å¯å¯ç”¨
  3. åŠŸèƒ½å®Œæ•´ï¼šæ”¯æŒæ‰€æœ‰ç°æœ‰äº‘ç›˜åŠŸèƒ½
  4. åé¦ˆåŠæ—¶ï¼šä¸Šä¼ è¿›åº¦å’Œç»“æœå®æ—¶æ˜¾ç¤º

  å­˜å‚¨ç»“æ„

  æœ¬åœ°å­˜å‚¨ï¼š
  D:\telegram_media_downloader\
  â””â”€â”€ TechChannel\
      â””â”€â”€ 2023_12\
          â”œâ”€â”€ photo\
          â”‚   â”œâ”€â”€ 12345 - image.jpg
          â”‚   â””â”€â”€ 12346 - photo.png
          â””â”€â”€ video\
              â””â”€â”€ 12347 - video.mp4

  123äº‘ç›˜å­˜å‚¨ï¼š
  /telegram/
  â””â”€â”€ TechChannel/
      â””â”€â”€ 2023_12/
          â”œâ”€â”€ photo/
          â”‚   â”œâ”€â”€ 12345 - image.jpg
          â”‚   â””â”€â”€ 12346 - photo.png
          â””â”€â”€ video/
              â””â”€â”€ 12347 - video.mp4

  æŠ€æœ¯æ”¶ç›Š

  æ¶æ„ä¼˜åŒ–

  - ç»Ÿä¸€æ¥å£ï¼šCloudDriveæ¨¡å—æ”¯æŒæ›´å¤šäº‘ç›˜ç±»å‹
  - æ‰©å±•æ€§å¼ºï¼šåç»­é›†æˆå…¶ä»–äº‘ç›˜æ›´å®¹æ˜“
  - ä»£ç å¤ç”¨ï¼šè·¯å¾„æ˜ å°„ã€é…ç½®ç®¡ç†ç­‰é€»è¾‘å¯å¤ç”¨
  - æµ‹è¯•å®Œå–„ï¼šå»ºç«‹äº‘ç›˜é›†æˆçš„æµ‹è¯•æ ‡å‡†

  å¼€å‘æ•ˆç‡

  - æ¨¡å—åŒ–è®¾è®¡ï¼šå„äº‘ç›˜é€‚é…å™¨ç‹¬ç«‹å¼€å‘
  - æ ‡å‡†åŒ–æ¥å£ï¼šç»Ÿä¸€çš„ä¸Šä¼ æ¥å£å’Œé…ç½®æ ¼å¼
  - æ–‡æ¡£å®Œå–„ï¼šä¸ºåç»­å¼€å‘æä¾›å‚è€ƒæ–‡æ¡£
  - ç»éªŒç§¯ç´¯ï¼šäº‘ç›˜APIé›†æˆçš„æœ€ä½³å®è·µ

---
  ğŸ“š é™„å½•

  APIå‚è€ƒæ–‡æ¡£

  - https://www.123pan.com/developer
  - https://123yunpan.yuque.com/org-wiki-123yunpan-muaork/cr6ced

  ç›¸å…³èµ„æº

  - https://github.com/tangyoha/telegram_media_downloader
  - https://github.com/tangyoha/telegram_media_downloader/wiki

  å¼€å‘ä¾èµ–

  # æ–°å¢ä¾èµ–
  httpx>=0.24.0         # HTTPå¼‚æ­¥å®¢æˆ·ç«¯
  aiofiles>=23.0.0      # å¼‚æ­¥æ–‡ä»¶æ“ä½œï¼ˆå¯é€‰ï¼‰

  # å¼€å‘ä¾èµ–
  pytest>=7.0.0         # å•å…ƒæµ‹è¯•æ¡†æ¶
  pytest-asyncio>=0.21.0 # å¼‚æ­¥æµ‹è¯•æ”¯æŒ
  responses>=0.23.0     # HTTP Mockæµ‹è¯•

  é…ç½®æ¨¡æ¿

  # config.yaml - 123äº‘ç›˜é…ç½®æ¨¡æ¿
  api_hash: your_api_hash
  api_id: your_api_id
  bot_token: your_bot_token

  save_path: ./downloads
  file_path_prefix:
    - chat_title
    - media_datetime
    - media_type
  file_name_prefix:
    - message_id
    - file_name
  file_name_prefix_split: ' - '

  upload_drive:
    enable_upload_file: true
    upload_adapter: pan123
    remote_dir: "/telegram"
    client_id: "your_123pan_client_id"
    client_secret: "your_123pan_client_secret"
    before_upload_file_zip: false
    after_upload_file_delete: true

  media_types:
    - audio
    - document
    - photo
    - video
    - voice
    - animation

  max_download_task: 5

---
  æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0åˆ›å»ºæ—¥æœŸï¼š2025-01-08æœ€åæ›´æ–°ï¼š2025-01-08å®¡æ ¸çŠ¶æ€ï¼šå¾…å®¡æ ¸